<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xml" href="../templates/dv-handbok.xslt"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="sv">
  <head>
    <title>Rättsinformationssystemets användning av Atom-flöden</title>
  </head>
  <body>
    <div id="frontpage">
      <h1>Atom-insamling</h1>
      <h2>Rättsinformationssystemets användning av Atom-flöden</h2>
      <!-- kort introduktionstext här -->
      <p id="contactinfo">[kontaktinformation]</p>
    </div>
    <div class="pagebreakbefore">
      <!-- revisionshistorik här -->
    </div>

    <div id="toc">
      <h2>Innehåll</h2>
      <ul/>
    </div>

    <div class="section">
      <h2>1. Inledning</h2>
      <h3>1.1. Syfte</h3>
      <p>
        Här beskrivs hur rättsinformationssystemet hanterar datakällor med 
        hjälp av s.k. Atom-flöden.
      </p>
      <h3>1.2. Bakgrund</h3>
      <p>Informationen i rättsinformationssystemet kommer primärt från
        andra myndigheter. Både dessa källor och systemets
        sammanställning (aggregat) av dem ska representeras av
        Atom-flöden. Systemets aggregerade källa utgör en komplett
        sammanställning av alla datakällor.
      </p>
      <h3>1.3. Definitioner</h3>
      <!-- TODO: utöka Ordlista (i <intro-implementatorer.xhtml>)
           - alt. separat <ordlista.xhtml>?
      -->
      <h4>1.3.1. Generella</h4>
      <dl>
        <dt>Atom</dt>
        <dd>Ett standardformat i XML för att representera flöden av 
          uppdateringar.</dd>
        <dt>Atom-flöde</dt>
        <dd>En representation av posters tillväxt i en datakälla. (Eng. 
          "feed".)</dd>
        <dt>Atom-post</dt>
        <dd>En paketering av ett eller flera digitala dokument som 
          beskriver/tillhör samma logiska resurs. (Eng. "entry".)</dd>
        <dt>Arkiv</dt>
        <dd>En arkiverad representation av ett flöde med fixerade start- och 
          slutdatum.</dd>
        <dt>Uppdatering</dt>
        <dd>Ändring av informationen för en post.</dd>
        <dt>Radering</dt>
        <dd>Borttagning (avpublicering) av en post (och därmed all information 
          som den paketerar).</dd>
        <dt>Kontrollsumma</dt>
        <dd>Ett digitalt "tumavtryck". En kontrollsumma beräknad på en digital 
          (binär) representation, designad för att upptäcka fel vid lagring och 
          överföring av information.</dd>
        <dt>MD5</dt>
        <dd>En kryptografisk algoritm (öppen och fri att använda) för att 
          beräkna kontrollsummor. Är inte garanterat unik i alla lägen, men 
          anses tillförlitlig för att säkerställa överförd data från en 
          pålitlig källa.</dd>
      </dl>
      <h4>1.3.2. Specifikt för rättsinformationsdomänen</h4>
      <dl>
        <dt>Rättsinformationssystemet</dt>
        <dd>Den uppsättning datasystem som samordnar syntax, semantik, 
          inhämtning och exponering av primär rättsinformation samt vyer av 
          dessa.</dd>
        <dt>Rättinformation</dt>
        <dd>Rättsliga dokument och metadata om dessa, inkluderande digitala 
          representationer av fysiska dokument, poster som beskriver dessa 
          med inneboende egenskaper samt relationer sinsemellan.</dd>
      </dl>
    </div>

    <div class="section">
      <h2>2. Varför Atom</h2>
      <h3>2.1. Källor</h3>
      <p>Rättsinformationssystemets datakällor utgörs av samlingar av
        poster som växer över tid. Posterna utgör en paketering av en
        "enhet" av rättsinformation (i regel ett dokument såsom en
        föreskrift), tillsammans med enhetens identifierare och en
        tidstämpel som anger när posten tillkommit eller uppdaterats i
        datakällan.
      </p>
      <p>Eftersom myndigheterna har publiceringsansvar är systemet byggt på att 
        dessa exponerar tillkommet material som listor av nytillkomna poster. 
        På så vis kan både det centrala systemet och andra intressenter hämta 
        information direkt från utgivarna allt eftersom den tillkommer. Detta 
        sker på samma vis som elektroniska nyhetsläsare (RSS-läsare) idag 
        hämtar ny information.
      </p>
      <p>RSS (eng. "Really Simple Syndication") är ett samlingsnamn på
        format som uttrycker flöden (eng. "feeds") för
        t.ex. nyhetsuppdateringar.  Ursprungligen stod RSS för "Rich
        Site Summary" och var ett enskilt format. Nuförtiden finns det
        flera versioner av detta format, och samlingsnamnet inkluderar
        både dem och Atom-formatet. Atom är ett specifikt, öppet,
        XML-baserat format som har standardiserats i form av RFC 4287
        (<a href="http://tools.ietf.org/html/rfc4287">The Atom
        Syndication Format</a>).
      </p>
      <p>Atom har valts för att det är öppet, standardiserat och väletablerat, 
        samt har explicit stöd för anpassning och utökning för olika ändamål, 
        t.ex. detaljerad hantering av paginering för t.ex. arkiverade 
        postförteckningar, raderingar av poster med mera. Det finns bra 
        verktygsstöd i olika programspråk/-plattformar för att hantera 
        formatet.
      </p>
      <h3>2.2. Specifikationer</h3>
      <p>Följande Atom-relaterade specifikationer används för att hantera 
        inhämtning och syndikering av innehållet i systemet:</p>
      <ul>
        <li>
          RFC 4287: <a href="http://tools.ietf.org/html/rfc4287">The Atom Syndication 
             Format</a>
         </li>
         <li>
           RFC 5005: <a href="http://tools.ietf.org/html/rfc5005">Feed Paging and 
              Archiving</a>
         </li>
         <li>
           RFC 6721: <a 
             href="http://tools.ietf.org/html/rfc6721">The 
             Atom "deleted-entry" Element</a>
         </li>
         <li>
           (Internet-draft) <a href="http://tools.ietf.org/html/draft-snell-atompub-link-extensions-09">Atom
             Link Extensions</a>
         </li>
      </ul>
      <p>Övriga specifikationer beskriver de detaljer som berör hantering av 
        stora mängder poster (m.h.a. länkade flöden), representation av 
        raderade poster (vid felpublicering) samt checksummor av överförda 
        dokument.
      </p>
      <h3>2.3. Paket respektive innehåll</h3>
      <p>
        Systemet använder Atom enbart för att beskriva tillkomst av poster av 
        information i systemet. Dessa kopplas med sin identifierare till den 
        faktiska resurs (återigen, primärt rättsinformationsdokument) som ingår 
        i rättsinformationen. Data (i form av digitala dokument) som beskriver 
        och representerar dessa resurser "paketeras" av posten (d.v.s. länkas 
        till).
      </p>
      <p>På detta vis hålls den tekniska hantering av tillkomst och den 
        information som tillhör denna process åtskiljd från 
        rättsinformationsdomänens specifika information.
      </p>
      <h3>2.4. Systemet som primär, auktoritativ datakälla</h3>
      <p>
        Systemets kontrollerade sammanställning (aggregat) av källorna
        exponeras på precis samma vis som källorna till
        systemet. Detta sammanställda flöde representerar tillkomsten
        av kontrollerade poster som hämtats från källorna. Denna källa
        utgör den primära källan för data ur
        rättsinformationssystemet, och kan konsumeras av allehanda
        rättsinformationsintressenter.</p>
    </div>

    <div class="section">
      <h2>3. Representationer i Atom</h2>
      <p>Atom-flöden uttrycks som postförteckningar i ett eller flera
        XML-dokument. Respektive post är försedd med en unik
        identifierare i form av en URI, samt en tidstämpel som anger
        uppdatering.
      </p>
      <p>
        Minst ett förteckningsdokument ska finnas för en källa till
        systemet.  Ett sådant dokument kallas prenumerationsdokument
        ("subscription feed", se RFC
        5005: <a href="http://tools.ietf.org/html/rfc5005">Feed Paging
        and Archiving</a> för detaljer) och är det dokument som ska
        länkas till för att komma åt datakällan som flödet
        representerar.
      </p>
      <p>Exempel på strukturen i ett feed-dokument:</p>
      <div class="syntax">
        <code class="xml"><![CDATA[
<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xml:lang="sv">

  <id>tag:riksarkivet.se,2009:rinfo:feed</id>

  <title>Riksarkivets författningssamling</title>

  <updated>2009-01-23T12:42:32Z</updated>

  <author>
    <name>Riksarkivet</name>
    <uri>http://www.statensarkiv.se/</uri>
    <email>rinfo@riksarkivet.ra.se</email>
  </author>

  <link rel="self"
        href="https://www.statensarkiv.se/rafs/feed/index.atom"/>
  <link rel="prev-archive"
        href=
      "https://www.statensarkiv.se/rafs/feed/archive/2008/index.atom"
      />

  <entry>
    <id>http://rinfo.lagrummet.se/publ/ra-fs/2006:6</id>
    <updated>2007-02-09T00:00:00.000Z</updated>
    <published>2007-02-09T00:00:00.000Z</published>
    <title>Föreskrifter om ändring av Riksarkivets föreskrifter och
        allmänna råd (RA-FS 2004:2) om gallring och återlämnande av
        handlingar vid upphandling;</title>
    <summary>Ändringen innebär att undantaget för myndigheter under
        Försvarsdepartementet har tagits bort och att de allmänna
        försäkringskassorna har tagits bort ur uppräkningen.</summary>
    <content type="application/pdf"
        src=
      "https://www.statensarkiv.se/Sve/RAFS/Filer/ra-fs-2006-06.pdf"
        hash="md5:3c5fc4bdc3306ae6541e97b89dbf4d16"/>
    <link rel="alternate"
        type="application/rdf+xml"
        href="https://www.statensarkiv.se/Sve/RAFS/showrdf?doc=2006-6"
        length="2317" hash="md5:e4e242a358b72405fdbf5ba8bc044b1a"/>
  </entry>

  <entry>
    <id>http://rinfo.lagrummet.se/publ/ra-fs/2004:2</id>
    <updated>2004-09-27T00:00:00.000Z</updated>
    <published>2004-09-27T00:00:00.000Z</published>
    <title>Riksarkivets föreskrifter och allmänna råd om gallring och
        återlämnande av handlingar vid upphandling;</title>
    <summary></summary>
    <content type="application/pdf"
          src=
        "https://www.statensarkiv.se/Sve/RAFS/Filer/ra-fs-2004-02.pdf"
          hash="md5:ca68b77f41ad2231586cf3e4d7970629"/>
    <link rel="alternate"
        type="application/rdf+xml"
        href="https://www.statensarkiv.se/Sve/RAFS/showrdf?doc=2004-2"
        length="2414" hash="md5:8051c695ef087fcc1183e51694c9c8c1"/>
  </entry>

</feed>
        ]]></code>
      </div>
      <div>
        <h3>3.1. Förteckningsdokumentets beståndsdelar</h3>
        <h4>3.1.1. Flödets ID</h4>
        <p>
          <em>Nödvändig information!</em>
        </p>
        <p>
          Elementet <code>id</code> anger en <em>persistent</em> identifierare 
          (URI) för datakällan. Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
<feed ...>
  <id>tag:riksarkivet.se,2009:rinfo:feed</id>
          ]]></code>
        </div>
        <p>
          Rent tekniskt spelar det ingen roll vad för slags URI som används så 
          länge denna inte ändras. Men i detta exempel används en <a 
            href="http://tools.ietf.org/html/rfc4151">TAG URI</a>. Sådana är 
          praktiska i feed-sammanhang, eftersom de inte är bundna till 
          http-platsen för dokument. Eftersom identifieraren ska vara 
          persistent över tid kan en HTTP-uri som inte längre leder någonstans 
          vara vilseledande.
        </p>
        <h4>3.1.2. Flödets titel</h4>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <title>Riksarkivets författningssamling</title>
          ]]></code>
        </div>
        <p>
          Anger någon slags titel på detta feed. Används inte till någonting av 
          Rättsinformationssystemet. Men den kan var användbar för någon som 
          tar del av denna källa via andra verktyg eller i andra sammanhang.
        </p>
        <h4>3.1.3. Flödets tidstämpel</h4>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <updated>2009-01-23T12:42:32Z</updated>
          ]]></code>
        </div>
        <p>
          Ska ange tidstämpel då något i detta feed-dokument ändrats. Anges som 
          <a href="http://tools.ietf.org/html/rfc4287#section-3.3">W3C Date 
             Time Format</a> (DTF).
        </p>
        <p>
          Observera att i exempet används "Zulu Time". Det är inte samma sak 
          som svensk tid. En del programmeringsspråk har inbyggt stöd för att 
          generera dessa, i andra fall finns det i regel tredjepartsbibliotek 
          för DTF.
        </p>
        <p>
          (Anledningen till att vi väljer Zulu Time här är för att dessa är 
          oberoende av tidzoner, <em>inklusive</em> sommartidavvikelser. 
          Tekniskt är det okej att istället för "Z" ange t.ex. "+01:00", för 
          svensk vintertid, "+02:00" för sommartid osv. Korrekt parsning av DTF 
          ska resultera i samma tidpunkt oavsett.)
        </p>
        <h4>3.1.4. Metadata för flödets utgivare</h4>
        <p>
          <em>Nödvändig information!</em>
        </p>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <author>
    <name>Riksarkivet</name>
    <uri>http://www.statensarkiv.se/</uri>
    <email>rinfo@riksarkivet.ra.se</email>
  </author>
          ]]></code>
        </div>
        <p>
          Anger kontaktinformation till ansvarig för publiceringen av denna 
          datakälla.
        </p>
        <p>
          Planen är att Rättsinformationssystemet ska använda denna information för 
          att rapportera om eventuella felaktigheter har uppstått vid inhämtning av 
          informationen.
        </p>
        <p>
          Därför är det lämpligt att e-postadressen går till en 
          funktionsbrevlåda istället för en enskild handläggare.
        </p>
        <p>
          Namn och URL används däremot inte av Rättsinformationssystemet, men 
          kan vara nyttig i andra sammanhang.
        </p>
        <h4>3.1.5. Addressen till flödets representation</h4>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <link rel="self"
      href="https://www.statensarkiv.se/rafs/feed/index.atom"/>
          ]]></code>
        </div>
        <p>
          Anger den adress där detta feed-dokument ligger. Är inte strikt 
          tekniskt nödvändig, men underlättar för någon som t.ex. sparar ner 
          dokumentet lokalt utan att notera ursprungsplats.
        </p>
        <h4>3.1.6. Länk till arkiv för äldre poster</h4>
        <p>
          <em>Viktig!</em>
        </p>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <link rel="prev-archive"
        href=
      "https://www.statensarkiv.se/rafs/feed/archive/2008/index.atom"
      />
          ]]></code>
        </div>
        <p>
          Anger plats för ett tidigare dokument i den sammanhängande kedjan av 
          publicerade feed-dokument över tid.
        </p>
        <p>
          Se <a href="http://tools.ietf.org/html/rfc5005">RFC 5005: Feed Paging and
            Archiving</a>.
          Rättsinformationssystemet kräver att dessa är konsistenta, samt 
          beständiga över tid så pass att det är garanterat att systemet har 
          hunnit hämta in informationen. (Exakta krav är inte fastställda, men 
          livslängder på minst ett år är rimliga.)
        </p>
        <p>
          Observera att arkiverade feed-dokument inte är nödvändiga. Om man har 
          en lågt antal rättsinformationsdokument kan samtliga förekomma i 
          samma feed-dokument under en överskådlig tid. Syftet med feed 
          archiving är att hantera storleken på feed-dokument över tid, så att 
          dessa inte växer till ohanterliga storlekar. Se asvnittet om <a 
            href="#s_arkiv">Arkiv</a> nedan för detaljer.
        </p>
      </div>
      <div>
        <h3>3.2. Tidstämplar i rättskällor respektive det centrala 
          systemet</h3>
        <p>Atom-flöden representerar en växande tidlinje av poster över tid. 
          Varje post har en tidstämpel i sitt <code>updated</code>-element som 
          anger när den uppstod, eller när information i posten senast 
          förändrats.
        </p>
        <p>Det är viktigt att särskilja denna maskinella tidsangivelse från de 
          formella datum och tider som gäller för det faktiska 
          rättsinformationsdokumentet (såsom utgivningsdatum och liknande). 
        </p>
        <p>Det är <em>av yttersta vikt</em> att tidstämplar respekteras med 
            avseende på:</p>
        <ul>
          <li>Att förändringar <em>måste</em> tidstämplas kronologiskt.</li>
          <li>Att inga tidstämplar för exponerat material modifieras i 
            efterhand.</li>
        </ul>
        <p>Eftersom systemet inhämtar resurser från rättskällorna måste det 
          lita på att kommunicerade tidstämplar gäller, så att allting före en 
          påträffad tidpunkt kan garanteras gälla information som redan 
          beaktats.</p>
        <p>Eftersom systemet exponerar all inhämtad (och egen) information på 
          samma vis som källorna &mdash; d.v.s. som Atom-flöden &mdash; kommer 
          poster som lästs in att få <em>nya</em> tidstämplar som återger 
          inhämtningstillfället.</p>
        <p>Originaltid (och URL:er) sparas ner för respektive post för att 
          kunna återge detaljer kring den inlästa posten.</p>
      </div>
      <div>
        <h3>3.3. Posternas innehåll</h3>
        <p>Varje post representeras av ett s.k. Atom Entry. Här anges URI:n för
          dokumentet (i elementet <code>id</code>), primär representation (i 
          elementet <code>content</code>) samt referenser till alternativa 
          representationer.
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <entry>
    <id>http://rinfo.lagrummet.se/publ/ra-fs/2004:2</id>
    <updated>2004-09-27T00:00:00.000Z</updated>
    <published>2004-09-27T00:00:00.000Z</published>
    <title>Riksarkivets föreskrifter och allmänna råd om gallring och
        återlämnande av handlingar vid upphandling;</title>
    <summary></summary>
    <content type="application/pdf"
          src=
        "https://www.statensarkiv.se/Sve/RAFS/Filer/ra-fs-2004-02.pdf"
          hash="md5:ca68b77f41ad2231586cf3e4d7970629"/>
    <link rel="alternate"
          type="application/rdf+xml"
          href=
            "https://www.statensarkiv.se/Sve/RAFS/showrdf?doc=2004-2"
          length="2414" hash="md5:8051c695ef087fcc1183e51694c9c8c1"/>
  </entry>
          ]]></code>
        </div>
        <h4>3.3.1. Postens ID</h4>
        <p>
          <em>Nödvändig information!</em>
        </p>
        <p>För att koppla en post till det rättsinformationsdokument den 
          paketerar används den officiella URI:n för dokumentet som värde i 
          Atom-postens ID.
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
    <id>http://rinfo.lagrummet.se/publ/ra-fs/2004:2</id>
          ]]></code>
        </div>
        <p>
          Rättsinformationssystemet matchar id:t i entry för ett 
          rättsinformationsdokument mot den officiella URI:n (den elektroniska 
          identifieraren) för detta dokument. Den kommer att användas av alla 
          system som hanterar poster i rättsinformationssystemet.
        </p>
        <p>
          För att rättsinformationsdokument-URI:er ska bli korrekta har 
          rättsinformationssystemet en algoritm för att konstruera dessa. Se 
          dokumenetet <a href="uri-principer.pdf">URI-principer</a> för hur 
          dessa ska konstrueras.
        </p>

        <h4>3.3.2. Postens tidstämplar</h4>
        <p>
          <em>Nödvändig information!</em>
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
    <updated>2007-02-09T00:00:00.000Z</updated>
          ]]></code>
        </div>
        <p>
          Uppdateringstiden i <code>updated</code> anger när något i posten 
          modifierats i källan. Rättsinformationssystemet använder denna för 
          att avgöra om posten för ett rättsinformationsdokument har 
          uppdaterats. Det är därför kritiskt att denna är korrekt angiven.
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
    <published>2007-02-09T00:00:00.000Z</published>
          ]]></code>
        </div>
        <p>
          Publiceringstiden i <code>published</code> anger när posten 
          officiellt publiceras i källan. För merparten av dokument kommer 
          denna att vara densamma som updated (se ovan), då förändringar av 
          rättsinformationsdokument i huvudsak görs i form av nya 
          rättsinformationsdokument (såsom rättelseblad och 
          ändringsförfattningar). Enbart i undantagsfall ska poster uppdateras 
          (eller tas bort) elektroniskt.
        </p>

        <h4>3.3.3. Titel och beskrivning</h4>
        <div class="syntax">
          <code class="xml"><![CDATA[
    <title>Riksarkivets föreskrifter och allmänna råd om gallring och
        återlämnande av handlingar vid upphandling;</title>
    <summary>...</summary>
          ]]></code>
        </div>
        <p>
          Dessa element måste enligt Atom-specifikationen finnas i en post. Det 
          är dock inte tekniskt nödvändigt att de innehåller något.
          Innehåll i dessa element används heller inte av 
          Rättsinformationssystemet. Vi rekommenderar ändå att något läsbart 
          värde används för att andra verktyg ska kunna presentera läsbar 
          information av detta feed. Utan värde kommer t.ex. många vanliga 
          feed-läsare inte att kunna skapa en användbar presentation av 
          Atom-flödet.
        </p>

        <h4>3.3.4. Huvudsakligt innehåll</h4>
        <p>
          <em>Nödvändig information!</em>
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
    <content type="application/pdf"
          src=
        "https://www.statensarkiv.se/Sve/RAFS/Filer/ra-fs-2004-02.pdf"
          hash="md5:ca68b77f41ad2231586cf3e4d7970629"/>
          ]]></code>
        </div>
        <p>
          En primär representation ska representera det faktiska 
          rättsinformationsdokumentet på ett av Rättsinformationssystemet 
          godkänt format.
        </p>
        <p>
          (Obs! Det är tänkt att systemet (åtminstone initialt) ska
          tolerera avsaknad av en digital dokumentrepresentation, så
          länge RDF-data om dokumentet finns tillgänglig. Denna
          tolerans är enbart till för de fall då det
          inte <em>går</em> att få fram en digital
          representation, inte för att minska kraven på vad
          rättskällorna ska publicera.)
        </p>
        <h4>3.3.5. Alternativa format</h4>
        <p>
          <em>Viktig!</em>
        </p>
        <p>
          De alternativa formaten som beskriver dokumentet länkas till som 
          följer.
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
    <link rel="alternate"
          href=
            "https://www.statensarkiv.se/Sve/RAFS/showrdf?doc=2004-2"
          type="application/rdf+xml"
          length="2414" hash="md5:8051c695ef087fcc1183e51694c9c8c1"/>
          ]]></code>
        </div>
        <p>
          Då dokumenten ska beskrivas med RDF-data <em>måste</em> minst ett 
          sådant dokument på ett av rättsinformationssystemet godkänt 
          RDF-format finnas länkat till.
        </p>
        <p>
          Se
            dokumentet <a href="http://dev.lagrummet.se/dokumentation/introduktion/intro-implementatorer.pdf">Introduktion
            till rättsinformationssystemet - För implementatörer och
            tekniskt ansvariga</a> för detaljer kring krav på
            inlämningsformat och innehåll.
        </p>
        <h4>3.3.6. Checksummor på länkade dokument</h4>
        <p>
          Som angivet i exemplen ovan ska respektive länkad resurs
          vara annoterad med storlek, mediatyp och en kontrollsumma i
          MD5. Se <a
          href="http://tools.ietf.org/html/draft-snell-atompub-link-extensions-09#section-3.2">Atom
          Link Extensions, sektion 3.2</a> för specifikationen av
          länk-attributet för kontrollsummor.
        </p>
        <div class="alert">
          <p>Denna specifikation förlitar sig på
            <a href="http://tools.ietf.org/html/draft-snell-atompub-link-extensions-09">Atom Link Extensions</a>
            för att ange checksummor. Denna är ännu en I-D, vilket inte
            garanterar en stabil specifikation. Sedan systemet specades har denna
            förändrats. Den tidigare formen på checksummor, specificerad i den nu
            osboleta
            <a href="http://tools.ietf.org/html/draft-snell-atompub-link-extensions-02">revision 2 av Atom Link Extensions</a>,
            såg ut likt följande:
          </p>
          <div class="syntax">
            <code class="xml"><![CDATA[
  <feed ...
        xmlns:le="http://purl.org/atompub/link-extensions/1.0">
    ...
      <content type="..." src="..."
               le:md5="d41d8cd98f00b204e9800998ecf8427e"/>
            ]]></code>
          </div>
          <p>Denna är nu ändrad till:</p>
          <div class="syntax">
            <code class="xml"><![CDATA[
      <content type="..." src="..."
               hash="md5:d41d8cd98f00b204e9800998ecf8427e"/>
            ]]></code>
          </div>
          <p>För att vara bakåtkompatibel stödjer inhämtningen båda dessa former.
            Även om denna I-D ännu inte har blivit en RFC förväntas den inte
            ändras substantiellt längre. Därför rekommenderas denna nya
            form.</p>
        </div>
        <h4>3.3.7. Bilagor</h4>
        <p>
          Enclosures representerar någon slags extern bilaga till den primära 
          resursen. Detta omfattar alltså bara de fall då bilagorna är separata 
          filer, och inte t.ex. PDF:er som inkluderar både huvuddokumentet och 
          tillhörande bilagor.
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
<feed ...
      xmlns:dct="http://purl.org/dc/terms/">
  ...
  <entry>
    ...

    <link rel="enclosure" 
          href=
    "http://www.slv.se/upload/lagstiftning/2005-2006/2006_22bil1.pdf"
          type="application/pdf"
          dct:isFormatOf=
              "http://rinfo.lagrummet.se/publ/livsfs/2006:22#bilaga_1"
          length="1168037"
          hash="md5:1115651b5e8380aff8d"/>
          ]]></code>
        </div>
        <p>
          Attributet <code>@dct:isFormatOf</code> skapar en koppling mellan 
          identifieraren för bilagan och själva filen som innehåller bilagan.
        </p>
        <p>Externa bilagor hämtas in och sparas på en ny URL baserad på att 
          antingen:
        </p>
        <!-- TODO: formalisera det som görs av koden i regler -->
        <ul>
          <li>lösa värdet i <code>@href</code> mot postens primära 
            innehållsreferens (<code>content/@src</code>), basera basen på 
            postens formella URI (angivet i <code>id</code>)</li>
          <li>använda <code>@dct:isFormatOf</code> plus filändelse för angiven 
            mediatyp.</li>
        </ul>
      </div>
    </div>

    <div class="section">
      <h2>4. Förändringar av existerande poster</h2>
      <h3>4.1. Uppdateringar</h3>
      <p>Uppdateringar är tillåtet för <em>viss form</em> av nytillkommen 
        post-data och -representationer. Eftersom rättsinformation är statisk i 
        betydelsen att den när den väl är utgiven inte förändras, bör i teorin 
        inga digitala förändringar som leder till uppdaterade dokument ske. I 
        praktiken kan dock vissa korrigeringar vara nödvändiga, så länge de 
        representerar maskinellt relaterade justeringar, t.ex. format- och 
        syntax, samt metadata.
      </p>
      <p>
        Den information som den juridiska texten utgör förändras inte
        med mindre än att nya rättsinformationsdokument
        tillkommer. Detta gäller även konsoliderade versioner av
        författningar. Varje konsolidering som görs till följd av att
        en ändringsförfattning antagits, betraktas inom systemet som
        en ny post.
      </p>
      <p>
        En uppdaterad post <em>ska</em> ha ett senare datum än 
        publiceringsdatumet. Detta för att undvika att en ny post av misstag 
        fått en redan befintlig identifierare.
      </p>
      <p>
        Atom-syntaxen kräver inte närvaron av <em>published</em> för att ange 
        den ursprungliga tidstämpel då posten publicerades. 
        Rättsinformationssystemet kräver dock närvaron av detta. Detta 
        tydliggör de fall då en post uppdaterats sedan ursprunglig publicering 
        (och likaledes då den är oförändrad, genom att både publiceringstid och 
        uppdateringstid är identiska).
      </p>
      <p>
        Således måste både ursprungstid och eventuell uppdateringstid sparas av 
        det publicerande systemet.
      </p>
      <h3>4.2. Raderade poster</h3>
      <p>
        För att hantera <em>felaktigt inkomna</em> poster exponeras även 
        <em>raderade</em> resurser.
      </p>
      <p>
        (Detaljer kring hur dessa förekommer i flödesdokumenten beskrivs i 
        kommande avsnitt, specifikt för <a href="#s_arkiv">Arkiv</a>-flöden. I 
        <a href="#s_kompletta_floeden">Kompletta flöden</a> behövs inte 
           explicita raderingar.)
      </p>
      <p>
        Raderingar representeras av ett
        <code>deleted-entry</code>-element, se <a
        href="http://tools.ietf.org/html/draft-snell-atompub-tombstones-06">The
        Atom "deleted-entry" Element</a>. Dessa element innehåller
        ID:t för posten som raderats samt raderingsdatum.
      </p>
      <p>
        Exempel på radering:
      </p>
      <div class="syntax">
        <code class="xml"><![CDATA[
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:at="http://purl.org/atompub/tombstones/1.0">
  ...

  <at:deleted-entry
      ref="http://rinfo.lagrummet.se/publ/ra-fs/3010:0"
      when="2010-03-08T15:55:34+0100"/>
        ]]></code>
      </div>
      <p>
        <em>(Notera att Atom-syntaxen förväntar sig att utökningar såsom dessa 
          för raderade poster ska placeras före <code>entry</code>-elementen. 
          Tidsordningen garanteras enbart via tidstämplarna.)</em>
      </p>
      <p>
        <strong>Obs!</strong> Detta stödjs enbart för att ta bort tekniskt 
        <em>felaktiga</em> poster, t.ex. då misstag vid publikation skett, 
        såsom fel eller ännu ej färdigställt dokument har publicerats, eller 
        formatmässigt trasiga filer lagts upp. Raderingar har ingenting med 
        upphävning av dokuments legala giltighet eller liknande att göra.
      </p>
      <p>
        Om möjligt ska <em>uppdateringar</em> av sådana felaktiga publiceringar 
        göras i första hand. Bara om systemet exponerat dokument som ännu inte 
        är giltiga, eller poster med icke-giltiga URI:er i postens 
        <code>id</code> är det lämpligt att uttrycka en radering i en 
        postförteckning.
      </p>
      <h4>4.2.1. Beständiga raderingar</h4>
      <p>
        Notera också att raderingar <em>måste</em> kommas ihåg av den som 
        publicerar sådana. Detta eftersom konsumenter av postförteckningen 
        måste underrättas om detta oavsett när de sist läste av denna.
      </p>
      <p>
        Det enda fall då en raderad post kan anses irrelevant i framtiden är om 
        en korrekt publicerad post med samma URI i <code>id</code>:t för posten 
        görs.
      </p>
    </div>

    <div class="section">
      <h2 id="s_kompletta_floeden">5. Kompletta flöden</h2>
      <p>
        Feeds markerade som kompletta (se <a 
          href="http://tools.ietf.org/html/rfc5005#section-2">RFC 5005, sektion 
          2</a>)
         är lämpliga för att publicera en lagom mängd dokument i en samling som 
         inte väntas växa avsevärt över tid.
      </p>
      <p>
        Ett flödesdokument markeras som komplett med:
      </p>
      <div class="syntax">
        <code class="xml"><![CDATA[
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:fh="http://purl.org/syndication/history/1.0">
  ...

  <fh:complete/>
        ]]></code>
      </div>
      <p>
        Dessa flöden representeras av ett sammanhållet Atom-dokument. Mängden 
        poster i sådana bör vara "rimligt liten", förslagsvis under tusentalet 
        som mjukt gränsvärde. En hantering av sådana skulle kräva att alla 
        poster från en given källa ska kunna sökas ut av systemet, och vid en 
        inhämtning skulle alla de som inte finns listade i det kompletta 
        flödet betraktas som raderade och tas bort ur det lokala lagret.
      </p>
    </div>

    <div class="section">
      <h2 id="s_arkiv">6. Arkiv</h2>
      <p>
        Större samlingar (eventuellt med många uppdateringar och/eller 
        raderingar) kan och bör delas upp i flera feed-dokument som länkar till 
        varandra, s.k. paginering av feeds. Det går inte att kombinera 
        kompletta flöden enligt sektion 5 med sådana arkiv.
      </p>
      <p>
        Paginering möjliggör långa tidsorterade listor av poster. För en stabil 
        inhämtning av sådana listor har systemet valt att både samla in och 
        exponera Atom-arkiv (se <a 
          href="http://tools.ietf.org/html/rfc5005#section-4">RFC 5005, sektion 
          4<!--Feed Paging and Archiving: 4. Archived Feeds--></a> för 
        specikationen av sådana).
      </p>
      <p>
        Tekniskt kan rimligen upp till något tusental entry-element i samma 
        dokument hanteras utan större problem. Men om man från början 
        uppskattar att tillväxttakten kommer att göra arkiverade feeds 
        nödvändiga är det möjligt att max några hundra poster per dokument är 
        en rimligare maxgräns. Detta är beroende på filstorlek och 
        överföringskapacitet, d.v.s webbinfrastruktur i stort. Beakta att 
        insamlande system kan komma att hämta hem åtminstone 
        prenumerationsdokumentet många gånger per dag, eller t.o.m. per 
        timme.
      </p>
      <p>
        Här spelar också HTTP-mekanismer för tidstämplar och ETags en stor 
        roll, vilka rekommenderas för att undvika överflödig inhämtning av 
        oförändrade dokument. Se detaljer kring "conditional GET" i 
        specifikationen för <a 
          href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.3">HTTP/1.1</a> 
        för detaljer.
      </p>
      <h3>6.1. Tillväxtproblem</h3>
      <p>
        En risk med detta är om en mängd uppdateringar sker från någon källa, t.ex. 
        en massiv korrigering av tusentals publicerade poster. I det fallet kommer 
        arkiv-listorna bli mer och mer ohanterbara för initial inhämtning, d.v.s. 
        då en konsument vill "grundladda" från systemet.
      </p>
      <!-- TODO: konsolidera nedanstående tankar med sista avsnittet i 
           "Konsekvenser" nedan! -->
      <h4 id="s_arkivhushaalning">6.1.1. Arkivhushållning</h4>
      <p>
        En möjlig lösning på detta är att <em>"kompaktera"</em> arkiven. Med 
        detta menas att hushålla i de äldre flödesdokumenten genom att städa i 
        gamla arkiv-feeds då poster uppdateras, och då helt plocka bort 
        inaktuella exponerade poster och/eller raderingar. Detta är tekniskt 
        tillåtet enligt RFC 5005, även om det inte uttryckligen förespråkas. 
        Genom ett sådant förfarande förloras formell historik, men samtidigt 
        uppnås en förbättring för konsumtionen av flödet eftersom behovet av 
        att hoppa över inaktuellt material kan elimineras.
      </p>
      <p>
        En liknande metod är att då och då skapa helt nya arkivdokument genom 
        att omindexera alla ingående poster och då inte exponera uppdaterade 
        historiska poster, eller raderade som sedemera blivit återskapade. För 
        att uppfylla kraven från RFC 5005 är det tillrådigt att låta de nya 
        arkiven få nya URL:er, eftersom de representerar nyskapade arkivlistor 
        (om än med gammalt material). En sådan omskrivning av arkiv kommer att 
        störa för insamlande system, men kan anses acceptabel om tiden för 
        störningen kan hållas till ett minimum (genom att t.ex. inte länka om 
        prenumerationsdokumentets första arkiv förrän de nya arkiven är klara, 
        och först efter det plocka bort de gamla arkivdokumenten.)
      </p>
      <!--
      <p>Exponera paginerade feeds som inte är underkastade samma regler som 
        arkiv; alternativt erbjud tidsfönster med hjälp av URL-parametrar 
        ("updated-min", "updated-max").
      </p>
      -->
    </div>

    <div class="section">
      <h2>7. Krav på publiceringen</h2>
      <h3>7.1. Checklista</h3>
      <p>
        I korthet ska följande beaktas vid skapandet av Atom-flöden som ska 
        utgöra källor till rättsinformationssystemet.
      </p>
      <ul>
        <li>Flödesdokument ska dela samma, för källan beständiga och unika 
          feed-id.</li>
        <li>Posternas entry-id:n ska motsvara URI:n för resursen 
          (rättsinformationsdokumentet) som posten levererar.
          (Se <a href="uri-principer.pdf">URI-principer</a> för hur dessa ska 
          konstrueras.)
        </li>
        <li>Den primära digitala representationen för dokumentet  ska länkas 
          till i postents <code>content</code>-element.</li>
        <li>RDF-data som beskriver postens dokument ska länkas till i <code>content</code> 
          (om det primära innehållet även innehåller metadata), eller i en 
          <code>alternate</code>-link.</li>
        <li>Alla länkade dokument ska ha en korrekt angiven 
          MD5-kontrollsumma.</li>
        <li>Datum i respektive flödesdokument ska följa kronologisk
        ordning (per feed-dokument; inbördes entry-ordning på XML-nivå
        är inte nödvändig då <code>updated</code>-värdet räcker för
        att ange detta).</li>
        <li>Fullständighet måste iakttagas, d.v.s. arkiven ska representera 
          alla aktuella uppdateringar och raderingar som gäller för 
          rättskällan.</li>
        <!--
        <li>stabilitet?</li>
        <li>"kompaktering"?</li>
        -->
      </ul>
    </div>

    <div class="section">
      <h2>8. Insamlingsmetod</h2>
      <p>
        Denna sektion beskriver hur rättsinformationssystemet centralt hanterar 
        insamling. Denna beskrivning är enbart för informativa syften.
      </p>
      <!-- TODO: utöka med detaljer om HTTP Conditional GET, d.v.s. 
           If-Modified-Since och ETag/If-None-Match.. -->
      <div>
        <h3>8.1. Generellt</h3>
        <p>Per sida:</p>
        <ol>
          <li>
            <p>Följ flödet bakåt i tid:</p>
            <ul>
              <li>
                <p>notera aktiva poster, senaste (yngsta) tidstämpel per 
                  entry-id som antingen är:
                </p>
                <ol>
                  <li>uppdaterad</li>
                  <li>raderad</li>
                </ol>
              </li>
              <li>följ <code>prev-archive</code> (bara för arkiv; se nedan)</li>
            </ul>
          </li>
          <li>
            <p>
              Samla in en aktiv post respektive radering i taget, i ordningen 
              äldst till yngst.
            </p>
            <p>
              (Detta säkerställer att den yngsta insamlade posten markerar vad 
              det insamlande systemet har lyckats samla in. På så vis 
              garanteras att påföjande insamlingar inte missar gammalt material 
              som av någon anledning inte kunnat hämtas in.)
            </p>
          </li>
        </ol>
        <p>
          <em>Viktigt!</em> Notera att insamlande system måste hålla koll på en 
          posts ursprungstidstämpel för updated och samtidigt exponera en ny 
          tidstämpel för updated om systemet aggrererar flera källor och inte 
          fullständigt kan lita på och samla in dessa källors poster i 
          kronologisk ordning ("breadth-first").
        </p>
      </div>
      <div>
        <h3>8.2. Insamling av kompletta flöden</h3>
        <p>
          Kompletta flöden är enkla att samla in, förutsatt att det insamlande 
          systemet sparar ner en lista på alla poster för respektive källas 
          feed-id. Gör följande för att samla in poster i sådana:
        </p>
        <ol>
          <li>hämta det kompletta flödet,</li>
          <li>använd feed-id:t för att läsa upp lista på alla poster i systemet 
            som kommer från denna källa,</li>
          <li>radera alla poster i listan från systemet som inte finns med i 
            det nya inlästa flödets förteckning,</li>
          <li>sortera posterna på "updated" i stigande ordning, d.v.s. äldst 
            (minsta tidstämpeln) först,</li>
          <li>för varje post, samla in ny data om dess updated är nyare än 
            exiserande insamlad posts ursprungstidstämpel.</li>
        </ol>
      </div>
      <div>
        <h3>8.3. Insamling av arkiv-flöden</h3>
        <p>
          En metod för att samla in poster från sådana arkiv är att:
        </p>
        <ol>
          <li>följ "subscription"-flödet och "prev-archive",
          </li>
          <li>för varje sida: sortera poster (och <i>raderingar</i>) på 
            "updated" i fallande ordning, d.v.s. yngst (största tidstämpeln) 
            först,
          </li>
          <li>spara entry-id + updated i mapp om updated inte finns för id:t 
              eller är större än (yngst) tidigare sparat updated-värde,
          </li>
          <li>stoppa när id+updated-par stöts på som finns lokalt inhämtad,
          </li>
          <li>klättra framåt i tiden längs inhämtade feeds och spara ner de 
            poster som finns i mappen med samma värden på id+updated.
          </li>
        </ol>
        <p>Detta säkerställer följande:
        </p>
        <ul><li>En markerad början görs (den senaste posten i "current" vid starten 
            för inhämtning). Detta säkerställer att inhämtningen inte fortgår på 
            obestämd tid i det (förvisso osannolika) fall då källan uppdateras 
            snabbare än inhämtningen.
          </li>
          <li>Inhämtad data sparas ner i kronologisk ordning, så att ingen slags 
            fel leder till "luckor" i tidsordningen (detta så att återupptagen 
            inhämtning kan lita på att lokalt inhämtat entry inte "skuggar" äldre, 
            ännu ej sedda poster).
          </li>
          <li>Inga onödiga inhämtningar av redan uppdaterade poster sker. (Detta 
            är viktigt eftersom gamla poster inte behöver länka till historiska 
            dokument, och därför kan ange felaktiga (d.v.s. gamla) 
            kontrollsummor och filstorlekar, alternativt peka på dokument som 
            tagits bort eller sakna länkar till nytillagda sådana.)
          </li>
        </ul>
        <p>
          (Obs! Naturligtvis måste alla feed-sidor som klättras vara försedda med 
          korrekt angivna updated-datum, så att inga yngre poster finns längre bak i 
          arkiven.)
        </p>
      </div>
    </div>

    <div class="section">
      <h2>9. Notifieringar om förändringar</h2>
      <p>
        Rättsinformationssystemet innehållen en lista på de rättskällor som 
        information ska samlas in ifrån. Systemet är konfiguererat så att det 
        då och då läser av alla källor, en i taget, för att samla in poster som 
        är nya eller förändrats/raderats sedan förra insamlingsrundan utförts.
      </p>
      <p>
        <em>Exakt hur ofta systemet gör denna insamling är inte fastställt 
          idag. Det är en relativt billig operation som kan förväntas göras 
          många gånger per dag, eventuellt oftare än en gång i timmen.</em>
      </p>
      <p>
        Idag kan rättsinformationssystemet även "pingas" om en källa uppdateras 
        och önskas inhämtas omedelbart. Detta sker genom att URL:en till en 
        datakällas prenumerationsdokument ("subscription feed") POST:as till 
        systemet. Om så sker, och källan är med i listan över godkända källor, 
        kommer systemet att påbörja en insamling direkt.
      </p>
      <p>
        Kontakta rättsinformationsprojektet för detaljer kring hur denna 
        notifieringsmekanism ska anropas.
      </p>
      <!-- TODO: specificera i samförstånd med pubsubhubbub-specen:
        http://pubsubhubbub.googlecode.com/svn/trunk/pubsubhubbub-core-0.3.html#anchor9
      -->
    </div>

    <div class="section">
      <h2>10. Konsekvenser</h2>
      <p>Alla poster hämtas in då och då över tid. Dessa sparas i det centrala 
        systemet och får där nya datumstämplar som motsvarar 
        inhämtningstillfället.
      </p>
      <p>
        Med denna insamlingsmetodik skapas en arkivlogg som utgör en komplett 
        lista på poster (inklusive uppdateringar och raderingar). Denna 
        exponeras av rättsinformationssystemet och utgör den primära 
        postförteckningen för systemet, och är således den primära datakällan 
        för konsumenter intresserade av den kompletta, tekniskt validerade 
        rättsinformationen.
      </p>
      <p>
        Stora, sammanställda arkivloggar kan bli svåranvänd p.g.a. många 
        korrigeringar i källorna. En lösning på detta är att, som nämns i <a 
          href="#s_arkivhushaalning">avsnitt 6</a> ovan, "hushålla" arkiv. 
        Detta kan åstadkommas genom att så fort en post uppdateras eller 
        raderas plocka bort den tidigare förekomsten (som kan ligga i något 
        äldre arkiv-dokument bak i tiden). I nuläget gör systemet inte detta, 
        men en lösning är planerad och kan komma att bli aktuell beroende på 
        hur många korrigeringar som i praktiken visar sig göras i de respektive 
        rättskällorna.</p>
    </div>

    <!-- Bilagor: Exempel
    <div id="bilaga_a" class="appendix">
      <h2>Bilaga A: Exempel</h2>
    </div>
    -->

  </body>
</html>
