<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xml" href="../templates/dv-handbok.xslt"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="sv">
  <head>
    <title>Rättsinformationssystemets användning av Atom-flöden</title>
  </head>
  <body>

    <h1>Rättsinformationssystemets användning av Atom-flöden</h1>
    <div id="toc">
      <h2>Innehåll</h2>
      <ul/>
    </div>

    <div class="section">
      <h2>1. Inledning</h2>
      <h3>1.1. Syfte</h3>
      <p>
        Här beskrivs hur rättsinformationssystemet hanterar datakällor med 
        hjälp av s.k. Atom-flöden.
      </p>
      <h3>1.2. Bakgrund</h3>
      <p>Informationen i rättsinformationssystemet kommer primärt från andra 
        myndigheter. Både dessa källor och systemets aggregat av dem ska 
        representeras av Atom-flöden. Systemets aggregerade källa utgör en 
        komplett sammanställning av alla datakällor.
      </p>
      <h3>1.4. Definitioner</h3>
      <!-- TODO: utöka Ordlista (i <intro-implementatorer.xhtml>)
           - alt. separat <ordlista.xhtml>?
      -->
      <h4>Generella</h4>
      <dl>
        <dt>Atom</dt>
        <dd>Ett standardformat i XML för att representera flöden av 
          uppdateringar.</dd>
        <dt>Atom-flöde</dt>
        <dd>En representation av posters tillväxt i en datakälla. (Eng.: 
          "feed".)</dd>
        <dt>Atom-post</dt>
        <dd>En paketering av ett eller flera digitala dokument som 
          beskriver/tillhör samma logiska resurs. (Eng.: "entry".)</dd>
        <dt>Arkiv</dt>
        <dd>En arkiverad representation av ett flöde med fixerade start- och 
          slutdatum.</dd>
        <dt>Uppdatering</dt>
        <dd>Ändring av informationen för en post.</dd>
        <dt>Radering</dt>
        <dd>Borttagning (avpublicering) av en post (och därmed all information 
          som den paketerar).</dd>
        <dt>Kontrollsumma</dt>
        <dd>Ett digitalt "tumavtryck". En kontrollsumma beräknad på en digital 
          (binär) representation, designad för att upptäcka fel vid lagring och 
          överföring av information.</dd>
        <dt>MD5</dt>
        <dd>En kryptografisk algoritm (öppen och fri att använda) för att 
          beräkna kontrollsummor. Är inte 100%:igt unik i alla lägen, men anses 
          tillförlitlig nog för att säkerställa överförd data från en pålitlig 
          källa.</dd>
      </dl>
      <h4>Specifikt för rättsinformationsdomänen</h4>
      <dl>
        <dt>Rättsinformationssystemet</dt>
        <dd>Den uppsättning datasystem som samordnar syntax, semantik, 
          inhämtning och exponering av primär rättsinformation samt vyer av 
          dessa.</dd>
        <dt>Rättinformation</dt>
        <dd>Rättsliga dokument och metadata om dessa, inkluderande digitala 
          representationer av fysiska dokument, poster som beskriver dessa 
          med inneboende egenskaper samt relationer sinsemellan.</dd>
      </dl>
    </div>

    <div class="section">
      <h2>2. Varför Atom</h2>
      <h3>2.1. Källor</h3>
      <p>Rättsinformationssystemets datakällor innehåller poster som växer över 
        tid. Posterna utgör en paketering av en "enhet" av rättsinformation (i 
        regel ett dokument såsom en föreskrift), tillsammans med enhetens 
        publika identifierare och en tidstämpel som anger när posten tillkommit 
        eller uppdaterats i datakällan.
      </p>
      <p>Eftersom myndigheterna har publiceringsansvar är systemet byggt på att 
        dessa exponerar tillkommet material som listor av nytillkomna poster. 
        På så vis kan både det centrala systemet och andra intressenter hämta 
        information direkt från utgivarna allt eftersom den tillkommer. Detta 
        sker på samma vis som elektroniska nyhetsläsare (RSS-läsare) idag 
        hämtar ny information.
      </p>
      <p>RSS (eng. "Really Simple Syndication") är ett samlingsnamn på format 
        som uttrycker flöden (eng. "feeds") för t.ex. nyhetsuppdateringar. 
        Ursprungligen stod RSS för "Rich Site Summary" och var ett enskilt 
        format. Nuförtiden finns det flera versioner av detta format, och 
        samlingsnamnet inkluderar både dem och Atom-formatet. Atom är ett 
        specifikt, öppet, XML-baserat format som tagits fram och 
        standardiserats som RFC 4287. (RFC:er, "Request For Comments", är 
        standarder vilka publiceras av The Internet Engineering Task Force, <a 
          href="http://www.ietf.org/">IETF</a>.)
      </p>
      <p>Atom har valts för att det är öppet, standardiserat och väletablerat,  
        samt har explicit stöd för anpassning och utökning för olika ändamål, 
        t.ex. detaljerad hantering av paginering för t.ex. arkiverade 
        postförteckningar, raderingar av poster med mera. Det finns bra 
        programmerings- och verktygsstöd i olika programspråk/-plattformar för 
        att hantera formatet.
      </p>
      <h3>2.2. Specifikationer</h3>
      <p>Följande Atom-relaterade specifikationer används för att hantera 
        inhämtning och syndikering av innehållet i systemet:</p>
      <ul>
        <li>
          <a href="http://tools.ietf.org/html/rfc4287">The Atom Syndication 
             Format</a>
         </li>
         <li>
           <a href="http://tools.ietf.org/html/rfc5005">Feed Paging and 
              Archiving</a>
         </li>
         <li>
           <a 
             href="http://tools.ietf.org/html/draft-snell-atompub-tombstones-06">The 
             Atom "deleted-entry" Element</a>
         </li>
         <li>
           <a 
             href="http://tools.ietf.org/html/draft-snell-atompub-link-extensions-02">Atom 
             Link Extensions</a>
         </li>
      </ul>
      <p>Övriga specifikationer beskriver de detaljer som berör hantering av 
        stora mängder poster (m.h.a. länkade flöden), representation av 
        raderade poster (vid felpublicering) samt checksummor av överförda 
        dokument.
      </p>
      <h3>2.3. Paket respektive innehåll</h3>
      <p>
        Systemet använder Atom enbart för att beskriva tillkomst av poster av 
        information i systemet. Dessa kopplas med sin identifierare till den 
        faktiska resurs (återigen, primärt rättsinformationsdokument) som ingår 
        i rättsinformationen. Data (dokument) som beskriver och representerar 
        dessa resurser "paketeras" av posten (länkas till).
      </p>
      <p>På detta vis hålls den tekniska hantering av tillkomst och den 
        information som tillhör denna process åtskiljd från 
        rättsinformationsdomänens specifika information.
      </p>
      <h3>2.4. Systemet som primär, auktoritativ datakälla</h3>
      <p>
        Systemets kontrollerade sammanställning av källorna exponeras på precis 
        samma vis som källorna till systemet. Detta sammanställda flöde 
        representerar tillkomsten av kontrollerade poster som hämtats från 
        källorna. Denna källa utgör den primära källan för data ur 
        rättsinformationssystemet, och kan konsumeras av allehanda 
        rättsinformationsintressenter.</p>
    </div>

    <div class="section">
      <h2>3. Representationer i Atom</h2>
      <p>Atom-flöden uttrycks som postförteckningar i ett eller flera 
        XML-dokument. Respektive post är försedd med ett unikt ID i form av en 
        URI, samt en tidstämpel som anger uppdatering.
      </p>
      <p>Exempel på strukturen av ett feed-dokument:</p>
      <div class="syntax">
        <code class="xml"><![CDATA[
<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:le="http://purl.org/atompub/link-extensions/1.0"
      xml:lang="sv">

  <id>tag:riksarkivet.se,2009:rinfo:feed</id>

  <title>Riksarkivets författningssamling</title>

  <updated>2009-01-23T12:42:32Z</updated>

  <author>
    <name>Riksarkivet</name>
    <uri>http://www.statensarkiv.se/</uri>
    <email>rinfo@riksarkivet.ra.se</email>
  </author>

  <link href="https://www.statensarkiv.se/rafs/feed/index.atom" rel="self"/>
  <link href="https://www.statensarkiv.se/rafs/feed/archive/2008/index.atom" rel="prev-archive"/>

  <entry>
    <id>http://rinfo.lagrummet.se/publ/ra-fs/2006:6</id>
    <updated>2007-02-09T00:00:00.000Z</updated>
    <published>2007-02-09T00:00:00.000Z</published>
    <title>Föreskrifter om ändring av Riksarkivets föreskrifter och allmänna
        råd (RA-FS 2004:2) om gallring och återlämnande av handlingar vid
        upphandling;</title>
    <summary>Ändringen innebär att undantaget för myndigheter under
        Försvarsdepartementet har tagits bort och att de allmänna
        försäkringskassorna har tagits bort ur uppräkningen.</summary>
    <content src="https://www.statensarkiv.se/Sve/RAFS/Filer/ra-fs-2006-06.pdf"
             type="application/pdf"
             le:md5="3c5fc4bdc3306ae6541e97b89dbf4d16"/>
    <link rel="alternate" 
          href="https://www.statensarkiv.se/Sve/RAFS/showrdf?doc=2006-6"
          type="application/rdf+xml"
          length="2317" le:md5="e4e242a358b72405fdbf5ba8bc044b1a"/>
  </entry>

  <entry>
    <id>http://rinfo.lagrummet.se/publ/ra-fs/2004:2</id>
    <updated>2004-09-27T00:00:00.000Z</updated>
    <published>2004-09-27T00:00:00.000Z</published>
    <title>Riksarkivets föreskrifter och allmänna råd om gallring och
        återlämnande av handlingar vid upphandling;</title>
    <summary></summary>
    <content src="https://www.statensarkiv.se/Sve/RAFS/Filer/ra-fs-2004-02.pdf"
             type="application/pdf"
             le:md5="ca68b77f41ad2231586cf3e4d7970629"/>
    <link rel="alternate"
          href="https://www.statensarkiv.se/Sve/RAFS/showrdf?doc=2004-2"
          type="application/rdf+xml"
          length="2414" le:md5="8051c695ef087fcc1183e51694c9c8c1"/>
  </entry>

</feed>
        ]]></code>
      </div>
      <div>
        <h3>3.1. Förteckningsdokumentets egenskaper</h3>
        <h4>ID</h4>
        <p>
          <strong>Viktig!</strong>
          Elementet <code>id</code> anger en *persistent* identifierare (URI) 
          för datakällan. Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
<feed ...>
  <id>tag:riksarkivet.se,2009:rinfo:feed</id>
          ]]></code>
        </div>
        <p>
          Rent tekniskt spelar det ingen roll vad för slags URI som används så 
          länge denna inte ändras. Men i detta exempel används en <a 
            href="http://tools.ietf.org/html/rfc4151">TAG URI</a>. Sådana är 
          praktiska i feed-sammanhang, eftersom de inte är bundna till 
          http-platsen för dokument. Eftersom identifieraren ska vara 
          persistent över tid kan en HTTP-uri som inte längre leder någonstans 
          vara vilseledande.
        </p>
        <h4>Flödets titel</h4>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <title>Riksarkivets författningssamling</title>
          ]]></code>
        </div>
        <p>
          Anger någon slags titel på detta feed. Används inte till någonting av 
          Rättsinformationssystemet. Men den kan var användbar för någon som 
          tar del av denna källa via andra verktyg eller i andra sammanhang.
        </p>
        <h4>Flödets Tidstämpel</h4>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <updated>2009-01-23T12:42:32Z</updated>
          ]]></code>
        </div>
        <p>
          Ska ange tidssstämpel då något i detta feed-dokument ändrats. Anges 
          som <a href="http://tools.ietf.org/html/rfc4287#section-3.3">W3C Date 
            Time Format</a>.
        </p>
        <p>
          Observera att i exempet används "Zulu Time". Det är inte samma sak 
          som svensk tid. En del programmeringsspråk har inbyggt stöd för att 
          generera dessa, i andra fall finns det i regel tredjepartsbibliotek 
          för W3C DTF.
        </p>
        <p>
          (Anledningen till att vi väljer Zulu Time här är för att dessa är 
          oberoende av tidszoner, *inklusive* sommartidsavvikelser. Tekniskt är 
          det okej att istället för "Z" ange t.ex. "+01:00", för svensk 
          vintertid, "+02:00" för sommartid osv. Korrekt parsning av DTF ska 
          resultera i samma tidpunkt oavsett.)
        </p>
        <h4>Metadata för flödets utgivare</h4>
        <p>
          <strong>Viktig!</strong>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <author>
    <name>Riksarkivet</name>
    <uri>http://www.statensarkiv.se/</uri>
    <email>rinfo@riksarkivet.ra.se</email>
  </author>
          ]]></code>
        </div>
        <p>
          Anger kontaktinformation till ansvarig för publiceringen av denna 
          datakälla.
        </p>
        <p>
          Planen är att Rättsinformationssystemet ska använda denna information för 
          att rapportera om eventuella felaktigheter har uppstått vid inhämtning av 
          informationen.
        </p>
        <p>
          Därför är det lämpligt att e-postadressen går till en 
          funktionsbrevlåda istället för en enskild handläggare.
        </p>
        <p>
          Namn och URL användsdäremot inte av Rättsinformationssystemet, men 
          kan vara nyttig i andra sammanhang.
        </p>
        <h4>Addressen till flödets representation</h4>
        <p>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <link href="https://www.statensarkiv.se/rafs/feed/index.atom" rel="self"/>
          ]]></code>
        </div>
        <p>
          Anger den adress där detta feed-dokument ligger. Är inte strikt 
          tekniskt nödvändig, men underlättar för någon som t.ex. sparar ner 
          dokumentet lokalt utan att notera ursprungsplats.
        </p>
        <h4>Länk till arkiv för äldre poster</h4>
        <p>
          <strong>Viktig!</strong>
          Exempel:
        </p>
        <div class="syntax">
          <code class="xml"><![CDATA[
  <link href="https://www.statensarkiv.se/rafs/feed/archive/2008/index.atom" 
        rel="prev-archive"/>
          ]]></code>
        </div>
        <p>
          Anger plats för ett tidigare dokument i den sammanhängande kedjan av 
          publicerade feed-dokument över tid.
        </p>
        <p>
          Se <a href="http://tools.ietf.org/html/rfc5005">RFC 5005: Feed Paging and
            Archiving</a>.
          Rättsinformationssystemet ställer *höga* krav på att dessa är 
          konsistenta, samt beständiga över tid så pass att det är garanterat 
          att systemet har hunnit hämta in informationen.
        <p>
        </p>
          (Exakta krav är inte fastställda, men livslängder på minst ett år är 
          rimliga.)
        <p>
        </p>
          Observera att arkiverade feed-dokument inte är nödvändiga. Om man har 
          en lågt antal rättsinformationsdokument kan samtliga förekomma i 
          samma feed-dokument under en överskådlig tid. Syftet med feed 
          archiving är att
          hantera storleken på feed-dokument över tid, så att dessa inte växer 
          till ohanterliga storlekar (tekniskt normativt, rimligen kan ett par 
          tusen entry-element hanteras utan större problem.)
        </p>
      </div>
      <div>
        <h3>3.2. Flödets struktur</h3>
        <!-- TODO: include from entry in example feed -->
        <p>Atom-flöden representerar en växande tidslinje av poster över tid. 
          Varje post har en tidstämpel i sitt <code>updated</code>-element som 
          anger när den uppstod, eller när information i posten senast 
          förändrats.
        </p>
        <p>Det är viktigt att särskilja denna maskinella tidsangivelse från de 
          formella datum och tider som gäller för det faktiska 
          rättsinformationsdokumentet (såsom utgivningsdatum och liknande). 
        </p>
        <p>Det är <em>av yttersta vikt</em> att tidstämplar respekteras med 
            avseende på:</p>
        <ul>
          <li>Att förändringar <em>måste</em> tidstämplas kronologiskt.</li>
          <li>Att inga tidstämplar för exponerat material modifieras i 
            efterhand.</li>
        </ul>
        <p>Eftersom systemet inhämtar resurser från rättskällorna måste det 
          lita på att kommunicerade tidstämplar gäller, så att allting före en 
          påträffad tidpunkt kan garanteras gälla information som redan 
          beaktats.</p>
      </div>
      <div>
        <h3>3.3. Tidstämplar i rättskällor respektive det centrala 
          systemet</h3>
        <p>Eftersom systemet exponerar all inhämtad (och egen) information på 
          samma vis som källorna &mdash; d.v.s. som Atom-flöden &mdash; kommer 
          poster som lästs in att få <em>nya</em> tidstämplar som återger 
          inhämtningstillfället.</p>
        <p>Originaltid (och URL:er) sparas ner för respektive post för att 
          kunna återge detaljer kring den inlästa posten.</p>
      </div>
      <div>
        <h3>3.4. Posternas innehåll</h3>
        <p>Varje post representeras av ett s.k. Atom Entry. Här anges URI:n för
          dokumentet (i atom:id), primär representation (i atom:content) samt
          referenser till alternativa representationer.
        </p>
        <p>En av dessa representationer måste innehålla RDF-data för att 
          uppfylla systemets krav (se [TODO] för detaljer kring krav på 
          inlämningsformat och innehåll).
        </p>
        <h4>3.4.1. ID:n - URI:er</h4>
        <p>För att koppla en post till det rättsinformationsdokument den 
          paketerar används den officiella URI:n för dokumentet som värde i 
          Atom-postens ID.
        </p>
        <p>
          <div class="syntax">
            <code class="xml"><![CDATA[
  <entry>
    <id>http://rinfo.lagrummet.se/publ/sfs/1999:175</id>
    ...
  </entry>
            ]]></code>
            </div>
        </p>
        <h4>3.4.2. Checksummor på länkade dokument</h4>
        <p>Vidare är respektive länkad resurs annoterad med storlek, mediatyp 
          och <a 
            href="http://tools.ietf.org/html/draft-snell-atompub-link-extensions-02#section-3.1">MD5-kontrollsumma</a>.
        </p>
        <h4>3.4.3. Bilagor</h4>
        <p>
          Enclosures representerar någon slags bilaga till den primära 
          resursen. Dessa hämtas också in och sparas på en ny URL baserad på 
          antingen:
        </p>
        <!-- TODO: formalisera det som görs av koden i regler -->
        <ul>
          <li>resolva href mot entry-id,</li>
          <li>resolva @dct:isFormatOf + mime-type,</li>
        </ul>
        <div class="syntax">
          <code class="xml"><![CDATA[
<feed ...
      xmlns:dct="http://purl.org/dc/terms/">
  ...
  <entry>
    ...

    <link rel="enclosure" 
          href="http://www.slv.se/upload/lagstiftning/2005-2006/2006_22bil1.pdf"
          type="application/pdf"
          dct:isFormatOf="http://rinfo.lagrummet.se/publ/livsfs/2006:22#bilaga_1"
          length="1168037"
          le:md5="1115651b5e8380aff8d"/>
          ]]></code>
        </div>
        <p>
          Attributet <code>dct:isFormatOf</code> skapar en koppling mellan 
          identifieraren för bilagan och själva filen som innehåller bilagan.
        </p>
      </div>
    </div>

    <div class="section">
      <h2>4. Förändringar av existerande poster</h2>
      <h3>4.1. Uppdateringar</h3>
      <p>Uppdateringar är tillåtet för <em>viss form</em> av nytillkommen 
        post-data och -representationer. Eftersom rättsinformation är statisk i 
        betydelsen att den när den väl är utgiven inte förändras, bör i teorin 
        inga digitala förändringar som leder till uppdaterade dokument ske. I 
        praktiken kan dock vissa korrigeringar vara nödvändiga, så länge de 
        representerar maskinellt relaterade justeringar, t.ex. format- och 
        syntax, samt metadata.
      </p>
      <p>
        Den normativa informationen som hör till den juridiska texten förändras 
        inte med mindre än att nya rättsinformationsdokument tillkommer.
      </p>
      <p>
        En uppdaterad post <em>ska</em> ha ett senare datum än 
        publiceringsdatumet. Detta för att undvika att en ny post av misstag 
        fått en redan befintlig identifierare.
      </p>
      <p>
        Atom-syntaxen kräver inte närvaron av <em>published</em> för att ange 
        den ursprungliga tidstämpel då posten publicerades. 
        Rättsinformationssystemet kräver dock närvaron av detta. Detta 
        tydliggör de fall då en post uppdaterats sedan ursprunglig publicering 
        (och likaledes då den är oförändrad, genom att både publiceringstid och 
        uppdateringstid är identiska).
      </p>
      <p>
        Således måste både ursprungstid och eventuell uppdateringstid sparas av 
        det publicerande systemet.
      </p>
      <h3>4.2. Raderade poster</h3>
      <p>
        För att hantera <em>felaktigt inkomna</em> poster exponeras även 
        <em>raderade</em> resurser.
      </p>
      <p>
        Raderingar representeras av: <a 
          href="http://tools.ietf.org/html/draft-snell-atompub-tombstones-06">The 
          Atom "deleted-entry" Element</a>. Dessa element innehåller ID:t för 
        posten som raderats samt raderingsdatum.
      </p>
      <p>
        Exempel på radering:
      </p>
      <div class="syntax">
        <code class="xml"><![CDATA[
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:at="http://purl.org/atompub/tombstones/1.0">
  ...

  <at:deleted-entry
      ref="http://rinfo.lagrummet.se/publ/ra-fs/3010:0"
      when="2010-03-08T15:55:34+0100"/>
        ]]></code>
      </div>
      <p>
        <em>(Notera att Atom-syntaxen förväntar sig att utökningar såsom dessa 
          för raderade poster ska placeras innan <code>entry</code>-elementen. 
          Tidsordningen garanteras enbart via tidstämplarna.)</em>
      </p>
      <p>
        <strong>Obs!</strong> Detta stödjs enbart för att ta bort tekniskt 
        <em>felaktiga</em> poster, t.ex. då misstag vid publikation skett, 
        såsom fel eller ännu ej färdigställt dokument har publicerats, eller 
        formatmässigt trasiga filer lagts upp. Raderingar har ingenting med 
        upphävning av dokuments legala giltighet eller liknande att göra.
      </p>
      <p>
        Om möjligt ska <em>uppdateringar</em> av sådana felaktiga publiceringar 
        göras i första hand. Bara om systemet exponerat dokument som ännu inte 
        är giltiga, eller poster med icke-giltiga URI:er i postens 
        <code>id</code> är det lämpligt att uttrycka en radering i en 
        postförteckning.
      </p>
      <h4>4.2.1. Beständiga raderingar</h4>
      <p>
        Notera också att raderingar <em>måste</em> kommas ihåg av den som 
        publicerar sådana. Detta eftersom konsumenter av postförteckningen 
        måste underrättas om detta oavsett när de sist läste av denna.
      </p>
      <p>
        Det enda fall då en raderad post kan anses irrelevant i framtiden är om 
        en korrekt publicerad post med samma URI i <code>id</code>:t för posten 
        görs.
      </p>
    </div>

    <div class="section">
      <h2>5. Kompletta flöden</h2>
      <p>
        Feeds markerade som <a 
          href="http://tools.ietf.org/html/rfc5005#section-2">kompletta</a>
         är lämpliga för att publicera en lagom mängd dokument i en samling som 
         inte väntas växa avsevärt över tid.
      </p>
      <p>
        Ett flödesdokument markeras som komplett med:
      </p>
      <div class="syntax">
        <code class="xml"><![CDATA[
<feed xmlns="http://www.w3.org/2005/Atom"
      xmlns:fh="http://purl.org/syndication/history/1.0">
  ...

  <fh:complete/>
        ]]></code>
      </div>
      <p>
        Dessa flöden representeras av ett sammanhållet Atom-dokument. Mängden 
        poster i sådana bör vara "rimligt liten", förslagsvis under tusentalet 
        som mjukt gränsvärde. En hantering av sådana skulle kräva att alla 
        entries från en given källa ska kunna sökas ut av systemet, och vid en 
        inhämtning skulle alla de som inte finns listade i det kompletta 
        feed:et betraktas som raderade och tas bort ur det lokala lagret.
      </p>
    </div>

    <div class="section">
      <h2>6. Arkiv</h2>
      <h3>6.3. Paginerad tillväxt över tid</h3>
      <p>
        Större samlingar (eventuellt med många uppdateringar och/eller 
        raderingar) kan och bör delas upp i flera feed-dokument som länkar till 
        varandra, s.k. paginering av feeds.</p>
      <p>
        Paginering möjliggör långa tidssorterade listor av poster. För en 
        stabil inhämtning av sådana listor har systemet valt att både samla in 
        och exponera Atom-arkiv. Se specikationen för dessa: <a 
          href="http://tools.ietf.org/html/rfc5005#section-4">Feed Paging and 
          Archiving: 4. Archived Feeds</a>.
      </p>
      <h4>6.3.1. Tillväxtproblem</h4>
      <p>
        En risk med detta är om en mängd uppdateringar sker från någon källa, t.ex. 
        en massiv korrigering av tusentals publicerade poster. I det fallet kommer 
        arkiv-listorna bli mer och mer ohanterbara för initial inhämtning, d.v.s. 
        då en konsument vill "grundladda" från systemet.
      </p>
      <p>
        Möjliga lösningar på detta är:
      </p>
      <ol>
        <li>"Hushåll" arkiven genom att omindexera posterna och då inte exponera 
          uppdaterade historiska poster, eller raderade som sedemera blivit 
          återskapade.
        </li>
        <li>Exponera paginerade feeds som inte är underkastade samma regler som 
          arkiv; alternativt erbjud tidsfönster med hjälp av URL-parametrar 
          ("updated-min", "updated-max").
        </li>
        <li>Städa i gamla arkiv-feeds då poster uppdateras, genom att t.ex. 
          helt plocka bort gamla exponerade revisioner och/eller raderingar.
        </li>
      </ol>
    </div>

    <div class="section">
      <h2>7. Krav på publiceringen</h2>
      <h3>Checklista</h3>
      <!-- TODO: se kommentarerna i våra feed-exempel -->
      <ul>
        <li>beständigt feed-id;</li>
        <li>Posternas ID:n ska motsvara URI:n för resursen som posten levererar.
          <!--(om det är ett rättsinformationsdokument) -->
          <!-- se URI:er för rättsinformationsdokument.. -->
          </li>
        <li>RDF-data som beskriver postens dokument levereras i content eller 
          alternate-link.</li>
        <li>checksumma</li>
        <li>kronologisk ordning (per feed-dokument; inbördes entry-ordning på 
          XML-nivå är inte nödvändig då updated-värdet räcker för att ange 
          detta);</li>
        <li>fullständighet: händelsearkiv inkl. uppdateringar, raderingar;</li>
        <li>stabilitet?</li>
        <li>"kompaktering"?</li>
      </ul>
    </div>

    <div class="section">
      <h2>8. Insamlingsmetod</h2>
      <h3>Generellt</h3>
      <p>per sida:</p>
      <ol>
        <li>följ flödet bakåt i tid:
          <ol>
            <li>
              <p>samla aktiva poster, senaste (yngsta) tidstämpel per entry-id 
                som antingen är:
              </p>
              <ol>
                <li>uppdaterad</li>
                <li>raderad</li>
              </ol>
            </li>
            <li>följ <code>prev-archive</code> (bara för arkiv; se nedan)</li>
          </ol>
        </li>
      </ol>
      <h3>8.1. Insamling av arkiv-flöden</h3>
      <p>
        En metod för att samla in poster från sådana arkiv är att:
      </p>
      <ol>
        <li>följ "subscription"-feed:et och "prev-archive",
        </li>
        <li>för varje sida: sortera entries (och <i>tombstones</i>) på 
          "updated" i fallande ordning (d.v.s. yngst (störst datum) först),
        </li>
        <li>spara entry-id + updated i mapp om updated inte finns för id:t 
            eller är större än (yngst) tidigare sparat updated-värde,
        </li>
        <li>stoppa när id+updated-par stöts på som finns lokalt inhämtad,
        </li>
        <li>klättra framåt i tiden längs inhämtade feeds och spara ner de 
          poster som finns i mappen med samma värden på id+updated.
        </li>
      </ol>
      <p>Detta säkerställer följande:
      </p>
      <ul><li>En markerad början görs (den senaste posten i "current" vid starten 
          för inhämtning). Detta säkerställer att inhämtningen inte fortgår på 
          obestämd tid i det (förvisso osannolika) fall då källan uppdateras 
          snabbare än inhämtningen.
        </li>
        <li>Inhämtad data sparas ner i kronologisk ordning, så att ingen slags 
          fel leder till "luckor" i tidsordningen (detta så att återupptagen 
          inhämtning kan lita på att lokalt inhämtat entry inte "skuggar" äldre, 
          ännu ej sedda entries).
        </li>
        <li>Inga onödiga inhämtningar av redan uppdaterade poster sker. (Detta 
          är viktigt eftersom gamla poster inte behöver länka till historiska 
          dokument, och därför kan ange felaktiga (d.v.s. gamla) checksummor 
          och filstorlekar, alternativt peka på dokument som tagits bort eller 
          sakna länkar till nytillagda sådana.)
        </li>
      </ul>
      <p>
        (Obs! Naturligtvis måste alla feed-sidor som klättras vara försedda med 
        korrekt angivna updated-datum, så att inga yngre poster finns längre bak i 
        arkiven.)
      </p>
      <h3>8.2. Insamling av kompletta flöden</h3>
      <p>Systemet sparar lista på URI:er för feed:ets ID. Samlar in nya sedan 
        sista läsning från sys (sortera på tid, backa; se Arkiv ovan). Raderar 
        alla som inte finns i listan..
      </p>
    </div>

    <div class="section">
      <h2>9. Konsekvenser</h2>
      <p>Alla poster hämtas in då och då över tid. Dessa sparas i Lagret och 
        får där nya datumstämplar som motsvarar inhämntningstillfället.
      </p>
      <p>
        + arkivlogg;
        - arkivlogg oanvändbar p.g.a. många korrigeringar i källorna..;
        behov av kompaktering?
      </p>
    </div>

    <!-- Bilagor: Exempel -->
    <div id="bilaga_a" class="appendix">
      <h2>Bilaga A: Exempel</h2>
    </div>

  </body>
</html>
